<!DOCTYPE html>
<html lang="en">
<head>
  <script>
    if (localStorage.getItem('adminLoggedIn') !== 'true') {
      window.location.href = 'Admin.html';
    }
  </script>
   <script>
  document.addEventListener('contextmenu', function (e) {
    e.preventDefault();
  });
</script>
<script>
  document.onkeydown = function(e) {
    if (
      e.keyCode === 123 || // F12
      (e.ctrlKey && e.shiftKey && e.keyCode === 73) || // Ctrl+Shift+I
      (e.ctrlKey && e.keyCode === 85) // Ctrl+U
    ) {
      return false;
    }
  };
</script>
  <meta charset="UTF-8" />
  <title>Admin Dashboard - SR Security</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
.status-label {
  font-weight: bold;
  padding: 4px 10px;
  border-radius: 5px;
  display: inline-block;
  text-transform: uppercase;
}

.status-approved {
  background-color: #d4edda;
  color: #155724;
}

.status-rejected {
  background-color: #f8d7da;
  color: #721c24;
}

.status-pending {
  background-color: #fff3cd;
  color: #856404;
}

.status-buttons button {
  margin-right: 5px;
  margin-top: 5px;
  padding: 5px 10px;
  cursor: pointer;
}
</style>
<style>
  * {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    font-family: "Segoe UI", sans-serif;
    background: url('https://i.pinimg.com/originals/5d/55/96/5d5596ed13364bb987b5c11d64d6f27b.jpg') no-repeat center center fixed;
    background-size: cover;
     -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  -webkit-user-drag: none;
  -khtml-user-drag: none;
  -moz-user-drag: none;
  -o-user-drag: none;
  user-drag: none;
  }

  header {
    background-color: rgba(0, 0, 0, 0.85);
    padding: 1.2rem;
    color: #fff;
    text-align: center;
    font-size: 2rem;
    font-weight: bold;
  }

  .container {
    background-color: rgba(255, 255, 255, 0.95);
    max-width: 1200px;
    margin: 2rem auto;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
  }

  .top-bar {
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  gap: 1rem;
  margin-bottom: 1rem;
}

@media (max-width: 600px) {
  .top-bar {
    flex-direction: column;
  }
}

 #searchInput,
#statusFilter {
  outline:none;
  padding: 10px;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 1rem;
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
}

  .total-count {
    font-weight: bold;
    margin-bottom: 1rem;
    color: #333;
  }

  .card {
    background-color: #fff;
    padding: 1rem;
    margin-bottom: 1rem;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transition: 0.2s ease;
  }

  .card:hover {
    transform: scale(1.01);
  }

  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .actions button {
    margin-left: 5px;
    padding: 6px 12px;
    font-size: 0.9rem;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }

  .view {
    background-color: #007bff;
    color: white;
  }

  .edit {
    background-color: #ffc107;
    color: black;
  }

  .delete {
    background-color: #dc3545;
    color: white;
  }

  .logout {
    background-color: #333;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    display: block;
    margin: 1.5rem auto 0;
    cursor: pointer;
    font-size: 1rem;
  }

  #detail-section {
    display: none;
    margin-top: 2rem;
    overflow-x: auto;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
    min-width: 600px;
  }

  th,
  td {
    border: 1px solid #ccc;
    padding: 10px;
    text-align: left;
    font-size: 0.95rem;
  }

  th {
    background-color: #007bff;
    color: white;
  }

  tr:nth-child(even) {
    background-color: #f9f9f9;
  }

  img.zoomable {
    max-width: 100px;
    cursor: zoom-in;
    border-radius: 6px;
    border: 1px solid #ccc;
  }

  /* Image Modal */
  .modal {
    display: none;
    position: fixed;
    z-index: 999;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    backdrop-filter: blur(5px);
    background: rgba(0, 0, 0, 0.8);
    justify-content: center;
    align-items: center;
  }

  .modal img {
    max-width: 90%;
    max-height: 90%;
    border-radius: 10px;
  }
  .link-group {
  display: flex;
  flex-direction: column;
  justify-content: space-evenly;
  align-items: center;
  margin-top: 2rem;
  gap: 1rem;
}

.link-group a {
  text-decoration: none;
  color: white;
  font-weight: bold;
  padding: 12px 20px;
  border-radius: 6px;
  width: 90%;
  max-width: 400px;
  text-align: center;
  transition: transform 0.2s ease, background-color 0.3s ease;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

/* Different button colors */
.link-group a:nth-child(1) { background-color: #dc3545; }  /* Red */
.link-group a:nth-child(2) { background-color: purple; }
.link-group a:nth-child(3) { background-color: orange; color: black; }
.link-group a:nth-child(4) { background-color: green; }
.link-group a:nth-child(5) { background-color: brown; }

/* Hover effect */
.link-group a:hover {
  transform: scale(1.03);
  opacity: 0.9;
}

/* Mobile responsive */
@media (max-width: 480px) {
  .link-group a {
    width: 95%;
    font-size: 0.95rem;
  }
}
  /* Mobile Styles */
  @media (max-width: 768px) {
    header {
      font-size: 1.5rem;
      padding: 1rem;
    }

    .container {
      padding: 1rem;
      margin: 1rem;
    }

    .card-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
    }

    .actions {
      width: 100%;
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .actions button {
      flex: 1 1 auto;
    }

    table {
      font-size: 0.85rem;
    }
  }

  @media (max-width: 480px) {
    .top-bar {
      flex-direction: column;
    }

    #searchInput,
    #statusFilter {
      width: 100%;
    }

    .logout {
      width: 100%;
    }
  }
</style>
<!--<style>
  * {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: url('https://i.pinimg.com/originals/5d/55/96/5d5596ed13364bb987b5c11d64d6f27b.jpg') no-repeat center center fixed;
  background-size: cover;
  -webkit-user-select: none;
  user-select: none;
}
#searchInput,#statusFilter {
      height:30px;
    }
header {
  background-color: rgba(0, 0, 0, 0.9);
  color: #fff;
  padding: 1.5rem;
  text-align: center;
  font-size: 2rem;
  font-weight: 600;
  letter-spacing: 1px;
}

.container {
  background-color: rgba(255, 255, 255, 0.97);
  margin: 2rem auto;
  padding: 2rem;
  border-radius: 12px;
  max-width: 1200px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
}

.top-bar {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  margin-bottom: 1rem;
}

.top-bar input,
.top-bar select {
  flex: 1 1 250px;
  padding: 10px;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 1rem;
  outline: none;
  transition: 0.3s;
}

.top-bar input:focus,
.top-bar select:focus {
  border-color: #007bff;
  box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.2);
}

.total-count {
  font-weight: bold;
  color: #333;
  margin: 1rem 0;
  font-size: 1.1rem;
}

.card {
  background-color: #fff;
  padding: 1rem;
  border-radius: 10px;
  margin-bottom: 1rem;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.card:hover {
  transform: scale(1.01);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
}

.card-header {
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 0.5rem;
  align-items: center;
}

.actions button {
  padding: 6px 14px;
  font-size: 0.9rem;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: 500;
  transition: 0.3s;
}

.actions .view { background-color: #007bff; color: white; }
.actions .edit { background-color: #ffc107; color: black; }
.actions .delete { background-color: #dc3545; color: white; }

.actions button:hover {
  opacity: 0.85;
}

.status-label {
  font-weight: bold;
  padding: 5px 12px;
  border-radius: 6px;
  display: inline-block;
  font-size: 0.9rem;
  text-transform: uppercase;
}

.status-approved { background: #d4edda; color: #155724; }
.status-pending { background: #fff3cd; color: #856404; }
.status-rejected { background: #f8d7da; color: #721c24; }

.status-buttons button {
  padding: 6px 12px;
  margin-right: 5px;
  margin-top: 6px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: 500;
}

.logout {
  background-color: #333;
  color: white;
  padding: 12px 24px;
  border: none;
  border-radius: 8px;
  font-size: 1rem;
  display: block;
  margin: 2rem auto;
  cursor: pointer;
  transition: background 0.3s ease;
}

.logout:hover {
  background-color: #000;
}

#detail-section {
  margin-top: 2rem;
  overflow-x: auto;
  display: none;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 1rem;
  min-width: 600px;
}

th, td {
  border: 1px solid #ccc;
  padding: 10px;
  text-align: left;
  font-size: 0.95rem;
}

th {
  background-color: #007bff;
  color: white;
}

tr:nth-child(even) {
  background-color: #f9f9f9;
}

img.zoomable {
  max-width: 100px;
  cursor: zoom-in;
  border-radius: 6px;
  border: 1px solid #ccc;
}

/* Modal */
.modal {
  display: none;
  position: fixed;
  z-index: 999;
  top: 0; left: 0;
  width: 100%; height: 100%;
  backdrop-filter: blur(5px);
  background-color: rgba(0, 0, 0, 0.85);
  justify-content: center;
  align-items: center;
}

.modal img {
  max-width: 90%;
  max-height: 90%;
  border-radius: 10px;
}
.link-group {
  display: flex;
  flex-direction: column;
  justify-content: space-evenly;
  align-items: center;
  margin-top: 2rem;
  gap: 1rem;
}

.link-group a {
  text-decoration: none;
  color: white;
  font-weight: bold;
  padding: 12px 20px;
  border-radius: 6px;
  width: 90%;
  max-width: 400px;
  text-align: center;
  transition: transform 0.2s ease, background-color 0.3s ease;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

/* Different button colors */
.link-group a:nth-child(1) { background-color: #dc3545; }  /* Red */
.link-group a:nth-child(2) { background-color: purple; }
.link-group a:nth-child(3) { background-color: orange; color: black; }
.link-group a:nth-child(4) { background-color: green; }

/* Hover effect */
.link-group a:hover {
  transform: scale(1.03);
  opacity: 0.9;
}

/* Mobile responsive */
@media (max-width: 480px) {
  .link-group a {
    width: 95%;
    font-size: 0.95rem;
  }
}
/* Responsive Design */
@media (max-width: 768px) {
  header {
    font-size: 1.6rem;
    padding: 1rem;
  }

  .container {
    padding: 1rem;
    margin: 1rem;
  }

  .card-header {
    flex-direction: column;
    align-items: flex-start;
  }

  .actions {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .actions button {
    flex: 1 1 auto;
  }

  table {
    font-size: 0.85rem;
  }
}

@media (max-width: 480px) {
  .top-bar {
    flex-direction: column;
  }

  .logout {
    width: 100%;
  }

  .card-header {
    gap: 1rem;
  }
}
 @media (max-width: 600px) {
  .top-bar #searchInput,
  .top-bar #statusFilter {
    font-size: 0.9rem !important;
    padding: 6px 12px !important;
    border: 1px solid #aaa !important;
    border-radius: 6px !important;
    height:30px;
    box-shadow: none !important;
    width: 100% !important;
    max-width: 100% !important;
  }

  .top-bar {
    flex-direction: column !important;
    gap: 0.75rem !important;
  }
 }
</style>-->
</head>
<body>
  <header>Admin Dashboard - SR Security</header>
  <div class="container">
    <div class="top-bar">
      <input type="text" id="searchInput" placeholder="Search by name, application number, or mobile number...">
      <select id="statusFilter">
        <option value="All">All Status</option>
        <option value="Registered">Registered</option>
        <option value="Pending">Pending</option>
        <option value="Failed">Failed</option>
      </select>
    </div>
    <div class="total-count" id="totalCount">Total Candidates: 0</div>
    <div id="dashboard"></div>

    <div id="detail-section">
      <h3>Candidate Details</h3>
      <table>
        <thead>
          <tr><th>#</th><th>Field</th><th>Value</th></tr>
        </thead>
        <tbody id="details-body"></tbody>
      </table>
    </div>
  </div>
  <div class="link-group">
   <a href="Technicalreport.html">Technical Reports</a>
   <a href="FeedbackinAdmin.html">User Feedbacks</a>
   <a href="Servicereqadmin.html">Service request</a>
   <a href="Rateadd.html">Manage Rate Schedule</a>
   <a href="Managelist.html">Manage Merit list/a>   
  </div>
  <button class="logout" onclick="logout()">Logout</button>

  <!-- Modal for Image Zoom -->
  <div class="modal" id="imgModal" onclick="this.style.display='none'">
    <img id="modalImage" src="" alt="Zoomed">
  </div>
  <!-- Edit Modal -->
<div id="editModal" class="modal" style="display:none;">
  <div style="background: white; padding: 20px; border-radius: 10px; max-width: 600px; width: 90%; position: relative;">
    <h3>Edit Candidate</h3>
    <form id="editForm">
      <input type="hidden" id="editKey" />
      <label>Apply For:</label><br>
      <input type="text" id="editApplyFor" /><br><br>
      <label>Name:</label><br>
      <input type="text" id="editName" required /><br><br>

      <label>Father Name:</label><br>
      <input type="text" id="editFatherName" /><br><br>

      <label>DOB:</label><br>
      <input type="date" id="editDOB" /><br><br>

      <label>Gender:</label><br>
      <input type="text" id="editGender" /><br><br>

      <label>Mobile:</label><br>
      <input type="text" id="editMobile" /><br><br>

      <label>Email:</label><br>
      <input type="email" id="editEmail" /><br><br>

      <label>Aadhaar Number:</label><br>
      <input type="text" id="editAadhaarNumber" /><br><br>

      <label>Permanent Address:</label><br>
      <input type="text" id="editAddress" /><br><br>

      <button type="submit">Save Changes</button>
      <button type="button" onclick="closeEditModal()">Cancel</button>
    </form>
  </div>
</div>
<script>
    function logout() {
      localStorage.removeItem('adminLoggedIn');
      window.location.href = 'Admin.html';
    }
  </script>
  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
  import { update } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

window.updateStatus = function (userId, status) {
  const statusRef = ref(db, "registrations/" + userId);
  update(statusRef, { status })
    .then(() => {
      alert("Status updated to " + status);
    })
    .catch((error) => {
      console.error("Failed to update status:", error);
    });
};
  const firebaseConfig = {
    apiKey: "AIzaSyAKjdzj6gcl6bfqvaI8sYEJv8KCDnHUwSM",
    authDomain: "srsecurity-9d62a.firebaseapp.com",
    databaseURL: "https://srsecurity-9d62a-default-rtdb.firebaseio.com",
    projectId: "srsecurity-9d62a",
    storageBucket: "srsecurity-9d62a.appspot.com",
    messagingSenderId: "801710662719",
    appId: "1:801710662719:web:376de7896a74f5db03848a"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const dashboard = document.getElementById("dashboard");
  const searchInput = document.getElementById("searchInput");
  const statusFilter = document.getElementById("statusFilter");
  const totalCount = document.getElementById("totalCount");
  const detailSection = document.getElementById("detail-section");
  const detailsBody = document.getElementById("details-body");

  const modal = document.getElementById("imgModal");
  const modalImage = document.getElementById("modalImage");
  let currentlyViewedAppNo = null;

  const getStatus = user => {
    if (user?.step4?.profileURL && user?.step4?.aadhaarURL) return "Registered";
    if (user?.step1 || user?.step2 || user?.step3) return "Pending";
    return "Failed";
  };

  function renderData(data) {
    dashboard.innerHTML = "";
    let count = 0;
    const search = searchInput.value.toLowerCase();
    const selectedStatus = statusFilter.value;

    Object.entries(data).forEach(([key, user]) => {
      const status = getStatus(user);
      const matchesStatus = selectedStatus === "All" || status === selectedStatus;
      const matchesSearch = (user.name || "").toLowerCase().includes(search)
        || (user.applicationNumber || "").toLowerCase().includes(search)
        || (user.mobile || "").toLowerCase().includes(search);

      if (matchesSearch && matchesStatus) {
        count++;
        const card = document.createElement("div");
        card.className = "card";
        const currentStatus = user.status || "Pending";

card.innerHTML = `
  <div class="card-header">
    <span><strong>${user.name || "Unnamed"}</strong> (${user.applicationNumber || "No App No"})</span>
    <div class="actions">
      <button class="view">View</button>
      <button class="edit">Edit</button>
      <button class="delete">Delete</button>
    </div>
  </div>
  <div class="card-body">
    <p>Status: <span class="status-label status-${currentStatus.toLowerCase()}">${currentStatus}</span></p>
    <div class="status-buttons">
      <button onclick="updateStatus('${key}', 'Approved')">✅ Approve</button>
      <button onclick="updateStatus('${key}', 'Pending')">⏳ Pending</button>
      <button onclick="updateStatus('${key}', 'Rejected')">❌ Reject</button>
    </div>
  </div>
`;

        card.querySelector(".view").onclick = () => showDetails(user);
        card.querySelector(".edit").onclick = () => openEditModal(user, key);
        card.querySelector(".delete").onclick = () => {
          if (confirm("Are you sure you want to delete this record?")) {
            remove(ref(db, "registrations/" + key));
          }
        };

        dashboard.appendChild(card);
      }
    });

    totalCount.innerText = `Total Candidates: ${count}`;
  }

  function showDetails(user) {
    // Toggle details section
    if (currentlyViewedAppNo === user.applicationNumber) {
      detailSection.style.display = "none";
      currentlyViewedAppNo = null;
      return;
    }

    currentlyViewedAppNo = user.applicationNumber;
    detailSection.style.display = "block";
    detailsBody.innerHTML = "";

    const fields = [
      ["Name", user.name],
      ["Father Name", user.step1?.fatherName],
      ["DOB", user.step1?.dob],
      ["Gender", user.step1?.gender],
      ["Mobile", user.mobile],
      ["Email", user.email],
      ["Apply For", user.applyFor], // ✅ Added this line to show applied post
      ["Aadhaar No", user.step3?.aadhaarNumber],
      ["Address", user.step3?.permAddress],
      ["Application No", user.applicationNumber],
      ["Password", user.password],
      ["Status", getStatus(user)],
    ];

    let serial = 1;
    fields.forEach(([field, value]) => {
      if (value) {
        detailsBody.innerHTML += `<tr><td>${serial++}</td><td>${field}</td><td>${value}</td></tr>`;
      }
    });

    const profileURL = user.step4?.profileURL || user.step3?.profilePhoto;
    const aadhaarURL = user.step4?.aadhaarURL || user.step3?.aadhaarPhoto;

    if (profileURL) {
      detailsBody.innerHTML += `<tr><td>${serial++}</td><td>Profile Photo</td><td><img class="zoomable" src="${profileURL}"></td></tr>`;
    }
    if (aadhaarURL) {
      detailsBody.innerHTML += `<tr><td>${serial++}</td><td>Aadhaar Photo</td><td><img class="zoomable" src="${aadhaarURL}"></td></tr>`;
    }

    document.querySelectorAll('.zoomable').forEach(img => {
      img.onclick = () => {
        modal.style.display = "flex";
        modalImage.src = img.src;
      };
    });

    window.scrollTo({ top: detailSection.offsetTop, behavior: "smooth" });
  }

  onValue(ref(db, "registrations"), snapshot => {
    const data = snapshot.val() || {};
    renderData(data);
  });

  searchInput.addEventListener("input", () => {
    onValue(ref(db, "registrations"), snapshot => {
      const data = snapshot.val() || {};
      renderData(data);
    });
  });

  statusFilter.addEventListener("change", () => {
    onValue(ref(db, "registrations"), snapshot => {
      const data = snapshot.val() || {};
      renderData(data);
    });
  });
</script>

  <script>
  function openEditModal(user, key) {
    document.getElementById("editKey").value = key;
    document.getElementById("editName").value = user.name || "";
    document.getElementById('editApplyFor').value = user.applyFor || "";
    document.getElementById("editFatherName").value = user.step1?.fatherName || "";
    document.getElementById("editDOB").value = user.step1?.dob || "";
    document.getElementById("editGender").value = user.step1?.gender || "";
    document.getElementById("editMobile").value = user.mobile || "";
    document.getElementById("editEmail").value = user.email || "";
    document.getElementById("editAadhaarNumber").value = user.step3?.aadhaarNumber || "";
    document.getElementById("editAddress").value = user.step3?.permAddress || "";

    document.getElementById("editModal").style.display = "flex";
  }

  function closeEditModal() {
    document.getElementById("editModal").style.display = "none";
  }

  document.getElementById("editForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const key = document.getElementById("editKey").value;
    const updatedData = {
      name: document.getElementById("editName").value,
      mobile: document.getElementById("editMobile").value,
      email: document.getElementById("editEmail").value,
      applyFor: document.getElementById('editApplyFor').value,
      step1: {
        fatherName: document.getElementById("editFatherName").value,
        dob: document.getElementById("editDOB").value,
        gender: document.getElementById("editGender").value,
      },
      step3: {
        aadhaarNumber: document.getElementById("editAadhaarNumber").value,
        permAddress: document.getElementById("editAddress").value,
      },
    };

    const { getDatabase, ref, update } = await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js");
    const db = getDatabase();
    update(ref(db, "registrations/" + key), updatedData)
      .then(() => {
        alert("Candidate updated successfully.");
        closeEditModal();
      })
      .catch((err) => {
        alert("Update failed: " + err.message);
      });
  });
</script>
<script>
  // Auto logout when the page is closed or reloaded
  window.addEventListener("beforeunload", function () {
    localStorage.removeItem("adminLoggedIn");
  });
</script>
<script>
  history.pushState(null, null, location.href);
  window.onpopstate = function () {
    history.go(1);
  };
</script>
</body>
</html>
